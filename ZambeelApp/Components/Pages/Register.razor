@page "/register"
@using ZambeelApp.Services
@using ZambeelApp.Models
@inject IZambeelService SP_Service
@inject Service_LINQ LINQ_Service
@rendermode InteractiveServer

<h3>ðŸŽ“ Student Registration</h3>

<div class="alert alert-info">
    <label>
        <input type="checkbox" @bind="useLinq" /> 
        <strong>Use LINQ Implementation?</strong> (Current: @(useLinq ? "LINQ" : "Stored Procedures"))
    </label>
</div>

<div class="card p-4" style="max-width: 600px;">
    <div class="mb-3">
        <label>Name:</label>
        <input class="form-control" @bind="studentName" placeholder="John Doe" />
    </div>
    <div class="mb-3">
        <label>Email:</label>
        <input class="form-control" @bind="email" placeholder="john@lums.edu.pk" />
    </div>
    <div class="row">
        <div class="col-md-4 mb-3">
            <label>School ID:</label>
            <input type="number" class="form-control" @bind="schoolId" />
        </div>
        <div class="col-md-4 mb-3">
            <label>Dept ID:</label>
            <input type="number" class="form-control" @bind="deptId" />
        </div>
        <div class="col-md-4 mb-3">
            <label>Enroll Year:</label>
            <input type="number" class="form-control" @bind="yearEnroll" />
        </div>
    </div>

    <button class="btn btn-primary" @onclick="HandleRegistration">Register Student</button>
</div>

@if (!string.IsNullOrEmpty(message))
{
    <div class="mt-3 alert @(isError ? "alert-danger" : "alert-success")">
        @message
    </div>
}

@code {
    // Form Fields
    private string studentName = "";
    private string email = "";
    private int schoolId = 1;
    private int deptId = 1;
    private int yearEnroll = 2025;

    // State
    private bool useLinq = false;
    private string message = "";
    private bool isError = false;

    private void HandleRegistration()
    {
        // 1. Validation (Simple UI Validation)
        if (string.IsNullOrWhiteSpace(studentName) || string.IsNullOrWhiteSpace(email))
        {
            message = "Please fill in all fields.";
            isError = true;
            return;
        }

        // 2. Factory Logic: Choose Service based on Checkbox
        IZambeelService activeService = useLinq ? LINQ_Service : SP_Service;

        // 3. Execute
        var result = activeService.RegisterStudent(email, studentName, schoolId, deptId, yearEnroll);

        // 4. Handle Result
        if (result.StartsWith("Success"))
        {
            isError = false;
            message = result;
        }
        else
        {
            isError = true;
            message = result;
        }
    }
}